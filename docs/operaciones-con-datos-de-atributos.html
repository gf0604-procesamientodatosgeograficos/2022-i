<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 14 Operaciones con datos de atributos | GF0604 Procesamiento de datos geográficos 2022-I</title>
<meta name="author" content="Manuel Vargas">
<meta name="description" content="14.1 Resumen Se les llama atributos a los elementos de datos no espaciales o geométricos de un conjunto de datos geoespaciales. Estos datos pueden ser de tipos numéricos o textuales, entre otros....">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 14 Operaciones con datos de atributos | GF0604 Procesamiento de datos geográficos 2022-I">
<meta property="og:type" content="book">
<meta property="og:description" content="14.1 Resumen Se les llama atributos a los elementos de datos no espaciales o geométricos de un conjunto de datos geoespaciales. Estos datos pueden ser de tipos numéricos o textuales, entre otros....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 14 Operaciones con datos de atributos | GF0604 Procesamiento de datos geográficos 2022-I">
<meta name="twitter:description" content="14.1 Resumen Se les llama atributos a los elementos de datos no espaciales o geométricos de un conjunto de datos geoespaciales. Estos datos pueden ser de tipos numéricos o textuales, entre otros....">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.23/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><script src="libs/plotly-locale-es-2.5.1/es.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">GF0604 Procesamiento de datos geográficos 2022-I</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Bienvenida</a></li>
<li><a class="" href="programa-del-curso.html">Programa del curso</a></li>
<li class="book-part">I. Introducción a la programación de computadoras</li>
<li><a class="" href="pensamiento-computacional.html"><span class="header-section-number">1</span> Pensamiento computacional</a></li>
<li><a class="" href="arquitectura-de-computadoras-y-lenguajes-de-programaci%C3%B3n.html"><span class="header-section-number">2</span> Arquitectura de computadoras y lenguajes de programación</a></li>
<li><a class="" href="interacci%C3%B3n-humano-computadora.html"><span class="header-section-number">3</span> Interacción humano-computadora</a></li>
<li><a class="" href="ejemplo-de-interfaz-de-l%C3%ADnea-de-comandos---gdalogr-biblioteca-para-lectura-y-escritura-de-datos-geoespaciales.html"><span class="header-section-number">4</span> Ejemplo de interfaz de línea de comandos - GDAL/OGR: biblioteca para lectura y escritura de datos geoespaciales</a></li>
<li><a class="" href="reproducibilidad.html"><span class="header-section-number">5</span> Reproducibilidad</a></li>
<li><a class="" href="markdown-lenguaje-de-marcado.html"><span class="header-section-number">6</span> Markdown: lenguaje de marcado</a></li>
<li><a class="" href="git-sistema-de-control-de-versiones.html"><span class="header-section-number">7</span> Git: sistema de control de versiones</a></li>
<li class="book-part">II. El lenguaje de programación R</li>
<li><a class="" href="r---conceptos-b%C3%A1sicos.html"><span class="header-section-number">8</span> R - Conceptos básicos</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">9</span> R Markdown</a></li>
<li><a class="" href="tidyverse-colecci%C3%B3n-de-paquetes-para-ciencia-de-datos.html"><span class="header-section-number">10</span> Tidyverse: colección de paquetes para ciencia de datos</a></li>
<li><a class="" href="dplyr-gram%C3%A1tica-para-manipulaci%C3%B3n-de-datos.html"><span class="header-section-number">11</span> dplyr: gramática para manipulación de datos</a></li>
<li class="book-part">III. Graficación estadística en R</li>
<li><a class="" href="paquetes-de-r-para-graficaci%C3%B3n-estad%C3%ADstica.html"><span class="header-section-number">12</span> Paquetes de R para graficación estadística</a></li>
<li class="book-part">IV. El ecosistema geoespacial de R</li>
<li><a class="" href="introducci%C3%B3n-al-manejo-de-datos-geoespaciales-en-r.html"><span class="header-section-number">13</span> Introducción al manejo de datos geoespaciales en R</a></li>
<li><a class="active" href="operaciones-con-datos-de-atributos.html"><span class="header-section-number">14</span> Operaciones con datos de atributos</a></li>
<li class="book-part">Evaluaciones</li>
<li><a class="" href="examen-corto-1.html">Examen corto 1</a></li>
<li><a class="" href="examen-corto-2.html">Examen corto 2</a></li>
<li><a class="" href="examen-corto-3.html">Examen corto 3</a></li>
<li><a class="" href="tarea-1.html">Tarea 1</a></li>
<li><a class="" href="tarea-2.html">Tarea 2</a></li>
<li class="book-part">Documentos y aplicaciones de ejemplo</li>
<li><a class="" href="covid-19-en-costa-rica.html">COVID-19 en Costa Rica</a></li>
<li><a class="" href="felinos-de-costa-rica.html">Felinos de Costa Rica</a></li>
<li class="book-part">Apéndices</li>
<li><a class="" href="conjuntos-de-datos.html">Conjuntos de datos</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="operaciones-con-datos-de-atributos" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Operaciones con datos de atributos<a class="anchor" aria-label="anchor" href="#operaciones-con-datos-de-atributos"><i class="fas fa-link"></i></a>
</h1>
<div id="resumen-13" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Resumen<a class="anchor" aria-label="anchor" href="#resumen-13"><i class="fas fa-link"></i></a>
</h2>
<p>Se les llama atributos a los elementos de datos no espaciales o geométricos de un conjunto de datos geoespaciales. Estos datos pueden ser de tipos numéricos o textuales, entre otros. Un conjunto de datos vectoriales puede tener asociados varios campos de atributos, mientras que un conjunto de datos raster tiene solamente uno.</p>
<p>Las operaciones con atributos en datos vectoriales incluyen creación de subconjuntos, agregación y cruce de datos. Estas operaciones pueden ejecutarse con funciones del paquete base de R o con las de paquetes de Tidyverse. Por su parte, las operaciones con atributos en datos raster incluyen creación de subconjuntos y resumen de información.</p>
</div>
<div id="trabajo-previo-9" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Trabajo previo<a class="anchor" aria-label="anchor" href="#trabajo-previo-9"><i class="fas fa-link"></i></a>
</h2>
<div id="lecturas-7" class="section level3" number="14.2.1">
<h3>
<span class="header-section-number">14.2.1</span> Lecturas<a class="anchor" aria-label="anchor" href="#lecturas-7"><i class="fas fa-link"></i></a>
</h3>
<p>Lovelace, R., Nowosad, J., &amp; Münchow, J. (2019). <em>Geocomputation with R</em> (capítulo 3). CRC Press. <a href="https://geocompr.robinlovelace.net/" class="uri">https://geocompr.robinlovelace.net/</a></p>
</div>
</div>
<div id="preparativos-1" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Preparativos<a class="anchor" aria-label="anchor" href="#preparativos-1"><i class="fas fa-link"></i></a>
</h2>
<div id="carga-de-paquetes-1" class="section level3" number="14.3.1">
<h3>
<span class="header-section-number">14.3.1</span> Carga de paquetes<a class="anchor" aria-label="anchor" href="#carga-de-paquetes-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Carga de paquetes</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span> <span class="co"># lectura de datos</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># transformación de datos</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span> <span class="co"># tablas interactivas</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> <span class="co"># manejo de datos vectoriales</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/">terra</a></span><span class="op">)</span> <span class="co"># manejo de datos raster</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span> <span class="co"># manejo de datos raster</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org">rgdal</a></span><span class="op">)</span> <span class="co"># manejo de datos raster</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span> <span class="co"># mapas interactivos</span></code></pre></div>
</div>
<div id="conjuntos-de-datos-para-ejemplos-1" class="section level3" number="14.3.2">
<h3>
<span class="header-section-number">14.3.2</span> Conjuntos de datos para ejemplos<a class="anchor" aria-label="anchor" href="#conjuntos-de-datos-para-ejemplos-1"><i class="fas fa-link"></i></a>
</h3>
<div id="cantones-de-costa-rica" class="section level4" number="14.3.2.1">
<h4>
<span class="header-section-number">14.3.2.1</span> Cantones de Costa Rica<a class="anchor" aria-label="anchor" href="#cantones-de-costa-rica"><i class="fas fa-link"></i></a>
</h4>
<p>Es un <a href="datos/ign/delimitacion-territorial-administrativa/cantones.geojson">archivo GeoJSON con los polígonos de los cantones de Costa Rica</a>. Este archivo proviene de un <a href="http://geos.snitcr.go.cr/be/IGN_5/wfs">geoservicio de tipo Web Feature Service (WFS)</a> publicado por el Instituto Geográfico Nacional (IGN). Se transforma a WGS84 para desplegarlo más fácilmente en <code>leaflet</code>.</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Lectura y visualización de datos geoespaciales de cantones</span>

<span class="co"># Lectura</span>
<span class="va">cantones</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span>
    dsn <span class="op">=</span> <span class="st">"datos/ign/delimitacion-territorial-administrativa/cantones.geojson"</span>,
    quiet <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="co"># transformación a WGS84</span>

<span class="co"># Visualización en un mapa</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>
  <span class="va">cantones</span><span class="op">$</span><span class="va">geometry</span>,
  extent <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">86.0</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">82.3</span>, ymin <span class="op">=</span> <span class="fl">8.0</span>, ymax <span class="op">=</span> <span class="fl">11.3</span><span class="op">)</span><span class="op">)</span>,
  main <span class="op">=</span> <span class="st">"Cantones de Costa Rica"</span>,
  axes <span class="op">=</span> <span class="cn">TRUE</span>,
  graticule <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-operaciones-datos-atributos_files/figure-html/carga-datos-cantones-1.png" width="672"></div>
</div>
<div id="casos-positivos-de-covid-19-en-antones-de-costa-rica" class="section level4" number="14.3.2.2">
<h4>
<span class="header-section-number">14.3.2.2</span> Casos positivos de covid-19 en antones de Costa Rica<a class="anchor" aria-label="anchor" href="#casos-positivos-de-covid-19-en-antones-de-costa-rica"><i class="fas fa-link"></i></a>
</h4>
<p>Es un <a href="datos/ministerio-salud/covid/05_30_22_CSV_POSITIVOS.csv">archivo CSV con el acumulado de casos positivos de covid-19 en cada cantón</a>. Es publicado regularmente por el Ministerio de Salud en el sitio web <a href="https://geovision.uned.ac.cr/oges/">Situación Nacional COVID-19</a>.</p>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Lectura, transformación y visualización de casos positivos acumulados de covid-19 en cantones de Costa Rica</span>

<span class="co"># Carga</span>
<span class="va">covid_cantonal_positivos</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"datos/ministerio-salud/covid/05_30_22_CSV_POSITIVOS.csv"</span>,
             locale <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/locale.html">locale</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="st">"WINDOWS-1252"</span><span class="op">)</span>, <span class="co"># para desplegar correctamente acentos y otros caracteres</span>
             col_select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"cod_provin"</span>, <span class="st">"provincia"</span>, <span class="st">"cod_canton"</span>, <span class="st">"canton"</span>, <span class="st">"30/05/2022"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Transformación</span>
<span class="va">covid_cantonal_positivos</span> <span class="op">&lt;-</span>
  <span class="va">covid_cantonal_positivos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>positivos <span class="op">=</span> <span class="st">'30/05/2022'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># renombramiento de columna</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">canton</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">canton</span> <span class="op">!=</span> <span class="st">"Otros"</span><span class="op">)</span> <span class="co"># borrado de filas con valor NA u "Otros" en la columna canton</span>

<span class="co"># Visualización en una tabla</span>
<span class="va">covid_cantonal_positivos</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span>options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    pageLength <span class="op">=</span> <span class="fl">5</span>,
    language <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">'//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json'</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-5496be1c6d4e4bedfe41" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5496be1c6d4e4bedfe41">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7],["San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","San José","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Alajuela","Cartago","Cartago","Cartago","Cartago","Cartago","Cartago","Cartago","Cartago","Heredia","Heredia","Heredia","Heredia","Heredia","Heredia","Heredia","Heredia","Heredia","Heredia","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Guanacaste","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Puntarenas","Limón","Limón","Limón","Limón","Limón","Limón"],[112,110,106,118,103,117,102,108,120,115,107,114,119,104,101,109,105,113,116,111,201,205,203,215,214,206,209,207,208,216,210,204,202,212,213,211,306,301,308,304,303,307,302,305,402,407,408,401,406,409,405,404,403,410,507,504,506,505,511,510,501,509,502,503,508,603,610,608,602,611,607,604,605,609,601,606,706,701,705,702,703,704],["Acosta","Alajuelita","Aserrí","Curridabat","Desamparados","Dota","Escazú","Goicoechea","León Cortés Castro","Montes de Oca","Mora","Moravia","Pérez Zeledón","Puriscal","San José","Santa Ana","Tarrazú","Tibás","Turrubares","Vázquez de Coronado","Alajuela","Atenas","Grecia","Guatuso","Los Chiles","Naranjo","Orotina","Palmares","Poás","Río Cuarto","San Carlos","San Mateo","San Ramón","Sarchí","Upala","Zarcero","Alvarado","Cartago","El Guarco","Jiménez","La Unión","Oreamuno","Paraíso","Turrialba","Barva","Belén","Flores","Heredia","San Isidro","San Pablo","San Rafael","Santa Barbara","Santo Domingo","Sarapiquí","Abangares","Bagaces","Cañas","Carrillo","Hojancha","La Cruz","Liberia","Nandayure","Nicoya","Santa Cruz","Tilarán","Buenos Aires","Corredores","Coto Brus","Esparza","Garabito","Golfito","Montes de Oro","Osa","Parrita","Puntarenas","Quepos","Guácimo","Limón","Matina","Pococí","Siquirres","Talamanca"],[4104,18973,10880,14518,43283,834,15134,25497,1339,9987,7132,11042,20987,5226,79939,15398,1958,15261,592,13885,64702,6078,13161,3112,3604,8865,4249,8078,6595,1521,32552,926,12730,3755,7257,2569,1835,33168,9620,1609,20370,9425,8799,8107,8831,5976,5841,31775,5346,6483,10362,8255,10378,7519,3314,3220,4135,7320,1310,3875,12834,1530,9235,11839,2858,5348,8645,5410,7493,6487,6276,3107,5527,3397,28090,7158,7842,16822,5822,20449,10349,5468]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cod_provin<\/th>\n      <th>provincia<\/th>\n      <th>cod_canton<\/th>\n      <th>canton<\/th>\n      <th>positivos<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"language":{"url":"//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json"},"columnDefs":[{"className":"dt-right","targets":[1,3,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="introducción-1" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Introducción<a class="anchor" aria-label="anchor" href="#introducci%C3%B3n-1"><i class="fas fa-link"></i></a>
</h2>
<p>Se les llama atributos a los elementos de datos no espaciales o geométricos de un conjunto de datos geográficos. Estos datos pueden ser de tipos numéricos o textuales, entre otros. Un conjunto de datos vectoriales puede tener asociados varios campos de atributos, mientras que un conjunto de datos raster tiene solamente uno.</p>
</div>
<div id="datos-vectoriales-1" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Datos vectoriales<a class="anchor" aria-label="anchor" href="#datos-vectoriales-1"><i class="fas fa-link"></i></a>
</h2>
<p>Las operaciones con atributos en datos vectoriales incluyen:</p>
<ul>
<li>Creación de subconjuntos (<em>subsetting</em>).<br>
</li>
<li>Agregación (<em>aggregation</em>).<br>
</li>
<li>Cruce (unión) de datos (<em>joining</em>).</li>
</ul>
<p>Seguidamente, se explicará como maneja estas operaciones el paquete <code>sf</code>.</p>
</div>
<div id="manejo-de-datos-de-atributos-con-el-paquete-sf" class="section level2" number="14.6">
<h2>
<span class="header-section-number">14.6</span> Manejo de datos de atributos con el paquete sf<a class="anchor" aria-label="anchor" href="#manejo-de-datos-de-atributos-con-el-paquete-sf"><i class="fas fa-link"></i></a>
</h2>
<p>Como se mencionó en capítulos anteriores, el paquete <code>sf</code> define una clase, llamada <code>sf</code>, la cual extiende la clase <code>data.frame</code> del paquete base de R. Los objetos de la clase <code>sf</code> tienen una fila (o <em>feature</em>) por cada observación y una columna por cada atributo. También tienen una columna especial para almacenar las geometrías (puntos, líneas, polígonos, etc.), la cual generalmente se denomina <code>geometry</code> o <code>geom</code>. Esto permite que sf utilice métodos (i.e. funciones) de la clase <code>data.frame</code>, tales como <code><a href="https://r-spatial.github.io/sf/reference/plot.html">plot()</a></code> y <code><a href="https://rdrr.io/pkg/terra/man/summary.html">summary()</a></code>, entre otros.</p>
<p>Además de <code>data.frame</code>, <code>sf</code> es compatible con clases como las del paquete <a href="https://tibble.tidyverse.org/">tibble</a>, las cuales pueden manipularse mediante los métodos de <code>dplyr</code>. Esto que permite un manejo <em>tidy</em> (i.e. ordenado, organizado) de los datos geoespaciales, de acuerdo con el enfoque de <a href="https://www.tidyverse.org/">Tidyverse</a>.</p>
<p>En la secciones siguientes, se explicará el manejo de datos de atributos tanto mediante funciones y operaciones del paquete base de R, como mediante Tidyverse.</p>
<div id="funciones-básicas-para-manejo-de-data-frames-y-objetos-sf" class="section level3" number="14.6.1">
<h3>
<span class="header-section-number">14.6.1</span> Funciones básicas para manejo de data frames y objetos sf<a class="anchor" aria-label="anchor" href="#funciones-b%C3%A1sicas-para-manejo-de-data-frames-y-objetos-sf"><i class="fas fa-link"></i></a>
</h3>
<p>Las siguientes son algunas de las funciones disponibles para obtener información básica de un objeto sf.</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Funciones básicas para manejo de objetos tipo data.frame y sf</span>

<span class="co"># Clase de cantones</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt; [1] "sf"         "data.frame"</span>

<span class="co"># Dimensiones (cantidad de filas y de columnas)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">dim</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt; [1] 82 11</span>

<span class="co"># Cantidad de filas (i.e. observaciones)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">nrow</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt; [1] 82</span>

<span class="co"># Cantidad de columnas (i.e. variables)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">ncol</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt; [1] 11</span>

<span class="co"># Nombres de las columnas</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt;  [1] "gml_id"     "gmlid"      "cod_catalo" "cod_canton"</span>
<span class="co">#&gt;  [5] "canton"     "ori_toponi" "area"       "cod_provin"</span>
<span class="co">#&gt;  [9] "provincia"  "version"    "geometry"</span>

<span class="co"># Estructura del conjunto de datos</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>
<span class="co">#&gt; Rows: 82</span>
<span class="co">#&gt; Columns: 11</span>
<span class="co">#&gt; $ gml_id     &lt;chr&gt; "limitecantonal_5k.1", "limitecantonal_…</span>
<span class="co">#&gt; $ gmlid      &lt;chr&gt; "limitecantonal_5k.1", "limitecantonal_…</span>
<span class="co">#&gt; $ cod_catalo &lt;chr&gt; "160104", "160104", "160104", "160104",…</span>
<span class="co">#&gt; $ cod_canton &lt;int&gt; 610, 607, 608, 605, 603, 119, 606, 704,…</span>
<span class="co">#&gt; $ canton     &lt;chr&gt; "Corredores", "Golfito", "Coto Brus", "…</span>
<span class="co">#&gt; $ ori_toponi &lt;chr&gt; "Tiene su origen en el topónimo del río…</span>
<span class="co">#&gt; $ area       &lt;dbl&gt; 623.61, 1752.75, 944.24, 1932.70, 2382.…</span>
<span class="co">#&gt; $ cod_provin &lt;int&gt; 6, 6, 6, 6, 6, 1, 6, 7, 6, 1, 1, 6, 1, …</span>
<span class="co">#&gt; $ provincia  &lt;chr&gt; "Puntarenas", "Puntarenas", "Puntarenas…</span>
<span class="co">#&gt; $ version    &lt;chr&gt; "20201222", "20201222", "20201222", "20…</span>
<span class="co">#&gt; $ geometry   &lt;MULTIPOLYGON [°]&gt; MULTIPOLYGON (((-82.94161 …</span></code></pre></div>
<p>La función <code><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry()</a></code> remueve la columna de geometría de un objeto <code>sf</code>. Puede ser útil cuando, por ejemplo, solo se necesita trabajar con los atributos o cuando la columna con la geometría consume demasiados recursos del computador.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de st_drop_geometry()</span>

<span class="co"># Remoción de la columna de geometría</span>
<span class="va">cantones_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>

<span class="co"># Nombres de las columnas (nótese que ya no está la columna de geometría)</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html">names</a></span><span class="op">(</span><span class="va">cantones_df</span><span class="op">)</span>
<span class="co">#&gt;  [1] "gml_id"     "gmlid"      "cod_catalo" "cod_canton"</span>
<span class="co">#&gt;  [5] "canton"     "ori_toponi" "area"       "cod_provin"</span>
<span class="co">#&gt;  [9] "provincia"  "version"</span>

<span class="co"># Clase de df_cantones (nótese como no se muestra ya la clase sf)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">cantones_df</span><span class="op">)</span>
<span class="co">#&gt; [1] "data.frame"</span>

<span class="co"># Tamaño del conjunto de datos original (tipo sf)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">)</span>, units<span class="op">=</span><span class="st">"Kb"</span><span class="op">)</span>
<span class="co">#&gt; 20442.9 Kb</span>

<span class="co"># Tamaño del conjunto de datos sin geometrías (tipo data.frame)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">cantones_df</span><span class="op">)</span>, units<span class="op">=</span><span class="st">"Kb"</span><span class="op">)</span>
<span class="co">#&gt; 42.5 Kb</span></code></pre></div>
<p>Para algunas operaciones, también es posible ocultar la columna de geometría de un conjunto de datos (sin borrarla) mediante el argumento <code>drop = TRUE</code>.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso del argumento drop</span>

<span class="co"># Sin drop = TRUE</span>
<span class="va">cantones</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"canton"</span>, <span class="st">"area"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt; Simple feature collection with 10 features and 2 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -84.55536 ymin: 8.040247 xmax: -82.55285 ymax: 9.76779</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;           canton    area                       geometry</span>
<span class="co">#&gt; 1     Corredores  623.61 MULTIPOLYGON (((-82.94161 8...</span>
<span class="co">#&gt; 2        Golfito 1752.75 MULTIPOLYGON (((-83.46678 8...</span>
<span class="co">#&gt; 3      Coto Brus  944.24 MULTIPOLYGON (((-82.90501 8...</span>
<span class="co">#&gt; 4            Osa 1932.70 MULTIPOLYGON (((-83.83946 9...</span>
<span class="co">#&gt; 5   Buenos Aires 2382.94 MULTIPOLYGON (((-83.32101 9...</span>
<span class="co">#&gt; 6  Pérez Zeledón 1901.08 MULTIPOLYGON (((-83.77329 9...</span>
<span class="co">#&gt; 7         Quepos  557.85 MULTIPOLYGON (((-84.13572 9...</span>
<span class="co">#&gt; 8      Talamanca 2792.23 MULTIPOLYGON (((-82.89452 9...</span>
<span class="co">#&gt; 9        Parrita  483.22 MULTIPOLYGON (((-84.30298 9...</span>
<span class="co">#&gt; 10       Tarrazú  291.27 MULTIPOLYGON (((-83.98178 9...</span>

<span class="co"># Con drop = TRUE</span>
<span class="va">cantones</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"canton"</span>, <span class="st">"area"</span><span class="op">)</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">]</span>
<span class="co">#&gt;           canton    area</span>
<span class="co">#&gt; 1     Corredores  623.61</span>
<span class="co">#&gt; 2        Golfito 1752.75</span>
<span class="co">#&gt; 3      Coto Brus  944.24</span>
<span class="co">#&gt; 4            Osa 1932.70</span>
<span class="co">#&gt; 5   Buenos Aires 2382.94</span>
<span class="co">#&gt; 6  Pérez Zeledón 1901.08</span>
<span class="co">#&gt; 7         Quepos  557.85</span>
<span class="co">#&gt; 8      Talamanca 2792.23</span>
<span class="co">#&gt; 9        Parrita  483.22</span>
<span class="co">#&gt; 10       Tarrazú  291.27</span></code></pre></div>
</div>
<div id="creación-de-subconjuntos" class="section level3" number="14.6.2">
<h3>
<span class="header-section-number">14.6.2</span> Creación de subconjuntos<a class="anchor" aria-label="anchor" href="#creaci%C3%B3n-de-subconjuntos"><i class="fas fa-link"></i></a>
</h3>
<p>Frecuentemente, es necesario extrer subconjuntos del conjunto de datos original, para facilidad de manejo y para atender requerimientos específicos de un análisis. En esta sección, se explican las diferentes opciones para creación de subconjuntos, tanto con el paquete base de R como con <code>dplyr</code>. En resumen, estas son las opciones:</p>
<ul>
<li>Con el paquete base:
<ul>
<li>La notación de <code>[]</code> y <code>$</code>
</li>
<li>La función <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code>
</li>
</ul>
</li>
<li>Con el paquete <code>dplyr</code>:
<ul>
<li>La función <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>
</li>
<li>La función <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code>
</li>
<li>La función <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>
</li>
</ul>
</li>
</ul>
<div id="notaciones-y-funciones-del-paquete-base" class="section level4" number="14.6.2.1">
<h4>
<span class="header-section-number">14.6.2.1</span> Notaciones y funciones del paquete base<a class="anchor" aria-label="anchor" href="#notaciones-y-funciones-del-paquete-base"><i class="fas fa-link"></i></a>
</h4>
<div id="la-notación-de-y" class="section level5" number="14.6.2.1.1">
<h5>
<span class="header-section-number">14.6.2.1.1</span> La notación de <code>[]</code> y <code>$</code><a class="anchor" aria-label="anchor" href="#la-notaci%C3%B3n-de-y"><i class="fas fa-link"></i></a>
</h5>
<p>La notación de paréntesis cuadrados (<code>[]</code>) y el signo de dólar (<code>$</code>) permite crear subconjuntos con base en la posición de filas y de columnas, por medio de nombres de columnas y a través de la especificación de condiciones (i.e. expresiones lógicas).</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de la notación []</span>

<span class="co"># Subconjunto especificado por posiciones de filas</span>
<span class="va">cantones</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>

<span class="co"># Subconjunto especificado por posiciones de columnas</span>
<span class="va">cantones</span><span class="op">[</span>, <span class="fl">8</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>

<span class="co"># Subconjunto especificado por nombres de columnas</span>
<span class="va">cantones</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"canton"</span>, <span class="st">"area"</span>, <span class="st">"provincia"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Especificación mediante una condición (i.e. expresión lógica):</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de la notación $</span>

<span class="co"># Cantones de la provincia de Cartago</span>
<span class="va">cantones</span><span class="op">[</span><span class="va">cantones</span><span class="op">$</span><span class="va">provincia</span> <span class="op">==</span> <span class="st">"Cartago"</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"canton"</span>, <span class="st">"provincia"</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>
<span class="co">#&gt;       canton provincia</span>
<span class="co">#&gt; 19 El Guarco   Cartago</span>
<span class="co">#&gt; 20   Cartago   Cartago</span>
<span class="co">#&gt; 22   Paraíso   Cartago</span>
<span class="co">#&gt; 23   Jiménez   Cartago</span>
<span class="co">#&gt; 24 Turrialba   Cartago</span>
<span class="co">#&gt; 26  Oreamuno   Cartago</span>
<span class="co">#&gt; 29  La Unión   Cartago</span>
<span class="co">#&gt; 34  Alvarado   Cartago</span></code></pre></div>
</div>
<div id="la-función-subset" class="section level5" number="14.6.2.1.2">
<h5>
<span class="header-section-number">14.6.2.1.2</span> La función subset()<a class="anchor" aria-label="anchor" href="#la-funci%C3%B3n-subset"><i class="fas fa-link"></i></a>
</h5>
<p>La función <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/subset">subset()</a> también retorna un subconjunto cuyos registros cumplen una condición.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de subset()</span>

<span class="co"># Cantones con área &gt;= 2000 km2</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html">subset</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"canton"</span>, <span class="st">"area"</span><span class="op">)</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>,
       <span class="va">area</span> <span class="op">&gt;=</span> <span class="fl">2000</span><span class="op">)</span>
<span class="co">#&gt;          canton    area</span>
<span class="co">#&gt; 5  Buenos Aires 2382.94</span>
<span class="co">#&gt; 8     Talamanca 2792.23</span>
<span class="co">#&gt; 70       Pococí 2408.76</span>
<span class="co">#&gt; 71   San Carlos 3352.33</span>
<span class="co">#&gt; 74    Sarapiquí 2144.38</span></code></pre></div>
<p>Los operadores lógicos y de comparación que pueden utilizarse en las condiciones de la función <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code>, y en expresiones lógicas en general, se listan en la siguiente tabla:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Operador</th>
<th align="left">Descripción</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">==</td>
<td align="left">igual a</td>
</tr>
<tr class="even">
<td align="left">!=</td>
<td align="left">distinto de</td>
</tr>
<tr class="odd">
<td align="left">&gt;, &lt;</td>
<td align="left">mayor que, menor que</td>
</tr>
<tr class="even">
<td align="left">&gt;=, &lt;=</td>
<td align="left">mayor o igual que, menor o igual que</td>
</tr>
<tr class="odd">
<td align="left">&amp;, |, !</td>
<td align="left">Operadores lógicos: y, o, no</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="métodos-del-paquete-dplyr" class="section level4" number="14.6.2.2">
<h4>
<span class="header-section-number">14.6.2.2</span> Métodos del paquete dplyr<a class="anchor" aria-label="anchor" href="#m%C3%A9todos-del-paquete-dplyr"><i class="fas fa-link"></i></a>
</h4>
<p>Las funciones del paquete base de R son confiables y ampliamente usadas. Sin embargo, el enfoque más moderno de <code>dplyr</code> permite flujos de trabajo más intuitivos y es más rápido, debido a que se apoya en código escrito en el lenguaje C++. Esto es útil, por ejemplo, cuando se trabaja con conjuntos de datos grandes (<em>big data</em>) y cuando se necesita integración con bases de datos. Los principales métodos de <code>dplyr</code> para creación de subconjuntos son <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> y <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>.</p>
<div id="el-método-select" class="section level5" number="14.6.2.2.1">
<h5>
<span class="header-section-number">14.6.2.2.1</span> El método select()<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-select"><i class="fas fa-link"></i></a>
</h5>
<p><code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> permite seleccionar y renombrar columnas de un conjunto de datos.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de dplyr::select()</span>

<span class="co"># Selección de columnas</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">canton</span>, <span class="va">provincia</span><span class="op">)</span> <span class="co"># se especifica el nombre del paquete para evitar un conflicto con raster::select</span>
<span class="co">#&gt; Simple feature collection with 82 features and 2 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -87.10188 ymin: 5.498558 xmax: -82.55285 ymax: 11.21964</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;           canton  provincia                       geometry</span>
<span class="co">#&gt; 1     Corredores Puntarenas MULTIPOLYGON (((-82.94161 8...</span>
<span class="co">#&gt; 2        Golfito Puntarenas MULTIPOLYGON (((-83.46678 8...</span>
<span class="co">#&gt; 3      Coto Brus Puntarenas MULTIPOLYGON (((-82.90501 8...</span>
<span class="co">#&gt; 4            Osa Puntarenas MULTIPOLYGON (((-83.83946 9...</span>
<span class="co">#&gt; 5   Buenos Aires Puntarenas MULTIPOLYGON (((-83.32101 9...</span>
<span class="co">#&gt; 6  Pérez Zeledón   San José MULTIPOLYGON (((-83.77329 9...</span>
<span class="co">#&gt; 7         Quepos Puntarenas MULTIPOLYGON (((-84.13572 9...</span>
<span class="co">#&gt; 8      Talamanca      Limón MULTIPOLYGON (((-82.89452 9...</span>
<span class="co">#&gt; 9        Parrita Puntarenas MULTIPOLYGON (((-84.30298 9...</span>
<span class="co">#&gt; 10       Tarrazú   San José MULTIPOLYGON (((-83.98178 9...</span>

<span class="co"># Selección y cambio de nombre de columnas</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">canton</span>, area_km2 <span class="op">=</span> <span class="va">area</span>, <span class="va">provincia</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 82 features and 3 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -87.10188 ymin: 5.498558 xmax: -82.55285 ymax: 11.21964</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;           canton area_km2  provincia</span>
<span class="co">#&gt; 1     Corredores   623.61 Puntarenas</span>
<span class="co">#&gt; 2        Golfito  1752.75 Puntarenas</span>
<span class="co">#&gt; 3      Coto Brus   944.24 Puntarenas</span>
<span class="co">#&gt; 4            Osa  1932.70 Puntarenas</span>
<span class="co">#&gt; 5   Buenos Aires  2382.94 Puntarenas</span>
<span class="co">#&gt; 6  Pérez Zeledón  1901.08   San José</span>
<span class="co">#&gt; 7         Quepos   557.85 Puntarenas</span>
<span class="co">#&gt; 8      Talamanca  2792.23      Limón</span>
<span class="co">#&gt; 9        Parrita   483.22 Puntarenas</span>
<span class="co">#&gt; 10       Tarrazú   291.27   San José</span>
<span class="co">#&gt;                          geometry</span>
<span class="co">#&gt; 1  MULTIPOLYGON (((-82.94161 8...</span>
<span class="co">#&gt; 2  MULTIPOLYGON (((-83.46678 8...</span>
<span class="co">#&gt; 3  MULTIPOLYGON (((-82.90501 8...</span>
<span class="co">#&gt; 4  MULTIPOLYGON (((-83.83946 9...</span>
<span class="co">#&gt; 5  MULTIPOLYGON (((-83.32101 9...</span>
<span class="co">#&gt; 6  MULTIPOLYGON (((-83.77329 9...</span>
<span class="co">#&gt; 7  MULTIPOLYGON (((-84.13572 9...</span>
<span class="co">#&gt; 8  MULTIPOLYGON (((-82.89452 9...</span>
<span class="co">#&gt; 9  MULTIPOLYGON (((-84.30298 9...</span>
<span class="co">#&gt; 10 MULTIPOLYGON (((-83.98178 9...</span></code></pre></div>
</div>
<div id="el-método-slice" class="section level5" number="14.6.2.2.2">
<h5>
<span class="header-section-number">14.6.2.2.2</span> El método slice()<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-slice"><i class="fas fa-link"></i></a>
</h5>
<p><code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> es el equivalente de <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> para filas. Crea un subconjunto con base en las posiciones de las filas.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de slice()</span>

<span class="co"># Subconjunto especificado mediante un rango de filas</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
</div>
<div id="el-método-filter" class="section level5" number="14.6.2.2.3">
<h5>
<span class="header-section-number">14.6.2.2.3</span> El método filter()<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-filter"><i class="fas fa-link"></i></a>
</h5>
<p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> es el equivalente en <code>dplyr</code> de la función <code><a href="https://rdrr.io/pkg/terra/man/subset.html">subset()</a></code> del paquete <code>base</code>. Retorna los registros que cumplen con una condición.</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Androides de "La Guerra de las Galaxias"</span>
<span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Droid"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 14</span>
<span class="co">#&gt;   name   height  mass hair_color skin_color  eye_color</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;    </span>
<span class="co">#&gt; 1 C-3PO     167    75 &lt;NA&gt;       gold        yellow   </span>
<span class="co">#&gt; 2 R2-D2      96    32 &lt;NA&gt;       white, blue red      </span>
<span class="co">#&gt; 3 R5-D4      97    32 &lt;NA&gt;       white, red  red      </span>
<span class="co">#&gt; 4 IG-88     200   140 none       metal       red      </span>
<span class="co">#&gt; 5 R4-P17     96    NA none       silver, red red, blue</span>
<span class="co">#&gt; 6 BB8        NA    NA none       none        black    </span>
<span class="co">#&gt; # … with 8 more variables: birth_year &lt;dbl&gt;, sex &lt;chr&gt;,</span>
<span class="co">#&gt; #   gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,</span>
<span class="co">#&gt; #   films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;</span></code></pre></div>
</div>
<div id="el-operador-pipe" class="section level5" number="14.6.2.2.4">
<h5>
<span class="header-section-number">14.6.2.2.4</span> El operador pipe (%&gt;%)<a class="anchor" aria-label="anchor" href="#el-operador-pipe"><i class="fas fa-link"></i></a>
</h5>
<p>Los métodos del paquete <code>dplyr</code> (y otros) suelen ser utilizados conjuntamente con el <a href="http://r4ds.had.co.nz/pipes.html">operador <em>pipe</em> (%&gt;%)</a>, el cual posibilita el “encadenamiento” (<em>chaining</em>) de funciones: la salida de la función previa se convierte en el primer argumento de la siguiente función. En el siguiente ejemplo, el conjunto de datos <a href="https://dplyr.tidyverse.org/reference/starwars.html">starwars</a> se pasa como entrada al método <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, para filtrar los personajes humanos. Seguidamente, el resultado se pasa a <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>, para seleccionar las columnas <code>name</code>, <code>homeworld</code> y <code>species</code>. Finalmente, <code><a href="https://dplyr.tidyverse.org/reference/slice.html">slice()</a></code> reduce el resultado a las 10 primeras filas.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Encadenamiento de funciones mediante pipes (%&gt;%)</span>

<span class="va">starwars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Human"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">homeworld</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 3</span>
<span class="co">#&gt;    name               homeworld species</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;  </span>
<span class="co">#&gt;  1 Luke Skywalker     Tatooine  Human  </span>
<span class="co">#&gt;  2 Darth Vader        Tatooine  Human  </span>
<span class="co">#&gt;  3 Leia Organa        Alderaan  Human  </span>
<span class="co">#&gt;  4 Owen Lars          Tatooine  Human  </span>
<span class="co">#&gt;  5 Beru Whitesun lars Tatooine  Human  </span>
<span class="co">#&gt;  6 Biggs Darklighter  Tatooine  Human  </span>
<span class="co">#&gt;  7 Obi-Wan Kenobi     Stewjon   Human  </span>
<span class="co">#&gt;  8 Anakin Skywalker   Tatooine  Human  </span>
<span class="co">#&gt;  9 Wilhuff Tarkin     Eriadu    Human  </span>
<span class="co">#&gt; 10 Han Solo           Corellia  Human</span></code></pre></div>
<p>Una alternativa al uso de <em>pipes</em> es el “anidamiento” (<em>nesting</em>) de las funciones:</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Anidamiento de funciones</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
      <span class="va">starwars</span>,
      <span class="va">species</span><span class="op">==</span><span class="st">"Human"</span>
    <span class="op">)</span>,
    <span class="va">name</span>, <span class="va">homeworld</span>, <span class="va">species</span>
  <span class="op">)</span>,
  <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 3</span>
<span class="co">#&gt;    name               homeworld species</span>
<span class="co">#&gt;    &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt;  </span>
<span class="co">#&gt;  1 Luke Skywalker     Tatooine  Human  </span>
<span class="co">#&gt;  2 Darth Vader        Tatooine  Human  </span>
<span class="co">#&gt;  3 Leia Organa        Alderaan  Human  </span>
<span class="co">#&gt;  4 Owen Lars          Tatooine  Human  </span>
<span class="co">#&gt;  5 Beru Whitesun lars Tatooine  Human  </span>
<span class="co">#&gt;  6 Biggs Darklighter  Tatooine  Human  </span>
<span class="co">#&gt;  7 Obi-Wan Kenobi     Stewjon   Human  </span>
<span class="co">#&gt;  8 Anakin Skywalker   Tatooine  Human  </span>
<span class="co">#&gt;  9 Wilhuff Tarkin     Eriadu    Human  </span>
<span class="co">#&gt; 10 Han Solo           Corellia  Human</span></code></pre></div>
<p><strong>Ejercicio: mediante las funciones <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> y <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> de <code>dplyr</code>, cree un nuevo objeto <code>sf</code> que contenga los cantones de Puntarenas y Guanacaste con área mayor o igual a 2000 km2. Incluya las columnas de provincia, cantón y área.</strong></p>
</div>
</div>
</div>
<div id="agregación-de-datos" class="section level3" number="14.6.3">
<h3>
<span class="header-section-number">14.6.3</span> Agregación de datos<a class="anchor" aria-label="anchor" href="#agregaci%C3%B3n-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Las operaciones de agregación realizan cálculos (suma, promedio, etc.) a partir de la agrupación de valores de variables. En esta sección, se explican funciones de agregación contenidas en los paquetes <code>stats</code>, <code>sf</code> y <code>dplyr</code>, las cuales son:</p>
<ul>
<li>Del paquete stats:
<ul>
<li>La función <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code>
</li>
</ul>
</li>
<li>Del paquete sf:
<ul>
<li>El método <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code><br>
</li>
</ul>
</li>
<li>Del paquete dplyr:
<ul>
<li>El método <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>
</li>
</ul>
</li>
</ul>
<div id="la-función-aggregate-de-stats" class="section level4" number="14.6.3.1">
<h4>
<span class="header-section-number">14.6.3.1</span> La función aggregate() de stats<a class="anchor" aria-label="anchor" href="#la-funci%C3%B3n-aggregate-de-stats"><i class="fas fa-link"></i></a>
</h4>
<p>La función <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code> del paquete <a href="https://rdrr.io/r/#stats">stats</a> aplica una función de agregación (ej. suma, promedio, mínimo, máximo) sobre una columna. El resultado es un objeto de tipo <code>data.frame</code>.</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de stats::agregate()</span>

<span class="co"># Suma de áreas de cantones por provincia</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">cantones</span>, 
  <span class="va">area</span> <span class="op">~</span> <span class="va">provincia</span>, 
  FUN <span class="op">=</span> <span class="va">sum</span>, 
  na.rm <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt;    provincia     area</span>
<span class="co">#&gt; 1   Alajuela  9772.26</span>
<span class="co">#&gt; 2    Cartago  3093.23</span>
<span class="co">#&gt; 3 Guanacaste 10196.30</span>
<span class="co">#&gt; 4    Heredia  2663.45</span>
<span class="co">#&gt; 5      Limón  9176.97</span>
<span class="co">#&gt; 6 Puntarenas 11298.51</span>
<span class="co">#&gt; 7   San José  4969.73</span></code></pre></div>
</div>
<div id="el-método-aggregate-de-sf" class="section level4" number="14.6.3.2">
<h4>
<span class="header-section-number">14.6.3.2</span> El método aggregate() de sf<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-aggregate-de-sf"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code> es una <a href="https://adv-r.hadley.nz/s3.html#s3-methods">función genérica</a>, lo que significa que puede comportarse de manera diferente, dependiendo de los valores de entrada. El paquete <code>sf</code> también provee una versión de <a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a>, la cual se activa cuando recibe un objeto <code>sf`` y se usa el argumento</code>by<code>. El resultado es un objeto de tipo</code>sf`.</p>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de sf::agregate()</span>

<span class="co"># Suma de áreas de cantones por provincia</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate</a></span><span class="op">(</span>
  <span class="va">cantones</span><span class="op">[</span><span class="st">"area"</span><span class="op">]</span>, 
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">cantones</span><span class="op">$</span><span class="va">provincia</span><span class="op">)</span>, 
  FUN <span class="op">=</span> <span class="va">sum</span>, 
  na.rm <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 7 features and 2 fields</span>
<span class="co">#&gt; Attribute-geometry relationship: 0 constant, 1 aggregate, 1 identity</span>
<span class="co">#&gt; Geometry type: GEOMETRY</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -87.10188 ymin: 5.498558 xmax: -82.55285 ymax: 11.21964</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;      Group.1     area                       geometry</span>
<span class="co">#&gt; 1   Alajuela  9772.26 POLYGON ((-84.46249 9.92404...</span>
<span class="co">#&gt; 2    Cartago  3093.23 POLYGON ((-83.77405 10.0635...</span>
<span class="co">#&gt; 3 Guanacaste 10196.30 MULTIPOLYGON (((-85.19022 1...</span>
<span class="co">#&gt; 4    Heredia  2663.45 POLYGON ((-84.17533 10.0046...</span>
<span class="co">#&gt; 5      Limón  9176.97 POLYGON ((-82.8705 9.76278,...</span>
<span class="co">#&gt; 6 Puntarenas 11298.51 MULTIPOLYGON (((-87.06866 5...</span>
<span class="co">#&gt; 7   San José  4969.73 POLYGON ((-84.15026 9.62930...</span></code></pre></div>
</div>
<div id="el-método-summarise-de-dplyr" class="section level4" number="14.6.3.3">
<h4>
<span class="header-section-number">14.6.3.3</span> El método <code>summarise()</code> de dplyr<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-summarise-de-dplyr"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> es el equivalente de <code><a href="https://r-spatial.github.io/sf/reference/aggregate.sf.html">aggregate()</a></code> en el paquete <code>dplyr</code>. Suele utilizarse conjuntamente con <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, que especifica la variable a agrupar.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de de summarise()</span>

<span class="co"># Suma de áreas de cantones por provincia</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">provincia</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>area_km2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">area</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 7 features and 2 fields</span>
<span class="co">#&gt; Geometry type: GEOMETRY</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -87.10188 ymin: 5.498558 xmax: -82.55285 ymax: 11.21964</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt; # A tibble: 7 × 3</span>
<span class="co">#&gt;   provincia  area_km2                               geometry</span>
<span class="co">#&gt;   &lt;chr&gt;         &lt;dbl&gt;                         &lt;GEOMETRY [°]&gt;</span>
<span class="co">#&gt; 1 Alajuela      9772. POLYGON ((-85.24136 11.06429, -85.241…</span>
<span class="co">#&gt; 2 Cartago       3093. POLYGON ((-83.99836 9.876381, -83.998…</span>
<span class="co">#&gt; 3 Guanacaste   10196. MULTIPOLYGON (((-85.08773 10.16581, -…</span>
<span class="co">#&gt; 4 Heredia       2663. POLYGON ((-84.16124 10.43999, -84.161…</span>
<span class="co">#&gt; 5 Limón         9177. POLYGON ((-83.67931 10.9093, -83.6793…</span>
<span class="co">#&gt; 6 Puntarenas   11299. MULTIPOLYGON (((-87.06792 5.504218, -…</span>
<span class="co">#&gt; 7 San José      4970. POLYGON ((-83.92911 10.19094, -83.929…</span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> permite renombrar las variables, como se muestra seguidamente.</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplo de renombramiento de variables con summarise()</span>

<span class="co"># Suma total de las áreas de cantones</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>area_km2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">area</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            cantidad_cantones <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 2 fields</span>
<span class="co">#&gt; Geometry type: MULTIPOLYGON</span>
<span class="co">#&gt; Dimension:     XY</span>
<span class="co">#&gt; Bounding box:  xmin: -87.10188 ymin: 5.498558 xmax: -82.55285 ymax: 11.21964</span>
<span class="co">#&gt; Geodetic CRS:  WGS 84</span>
<span class="co">#&gt;   area_km2 cantidad_cantones                       geometry</span>
<span class="co">#&gt; 1 51170.45                82 MULTIPOLYGON (((-87.06792 5...</span></code></pre></div>
<p>El siguiente ejemplo utiliza otras funciones del paquete <code>dplyr</code> para encontrar las tres provincias más grandes y sus respectivas áreas, con base en los datos disponibles en la capa de cantones.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Área y cantidad de cantones de las tres provincias más grandes</span>
<span class="va">cantones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">provincia</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">provincia</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">sum</a></span><span class="op">(</span><span class="va">area</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
            cantidad_cantones <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, wt <span class="op">=</span> <span class="va">area</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 × 3</span>
<span class="co">#&gt;   provincia    area cantidad_cantones</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;dbl&gt;             &lt;int&gt;</span>
<span class="co">#&gt; 1 Puntarenas 11299.                11</span>
<span class="co">#&gt; 2 Guanacaste 10196.                11</span>
<span class="co">#&gt; 3 Alajuela    9772.                16</span></code></pre></div>
<p><strong>Ejercicio: mediante <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, y otras funciones de dplyr, despliegue el área y la cantidad de cantones de las dos provincias más pequeñas.</strong></p>
</div>
</div>
<div id="cruce-de-datos" class="section level3" number="14.6.4">
<h3>
<span class="header-section-number">14.6.4</span> Cruce de datos<a class="anchor" aria-label="anchor" href="#cruce-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>La combinación de datos ubicados en diferentes fuentes es una tarea común en análisis de información. Este tipo de operaciones se realizan con base en atributos que son comunes en los conjuntos de datos que se desea “cruzar” (<em>join</em>). El paquete <code>dplyr</code> proporciona varios <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">métodos para realizar cruces de datos</a>, entre los que se encuentran:</p>
<ul>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join()</a></code></li>
</ul>
<p>Seguidamente, se ejemplificarán las dos primeras.</p>
<div id="el-método-left_join" class="section level4" number="14.6.4.1">
<h4>
<span class="header-section-number">14.6.4.1</span> El método left_join()<a class="anchor" aria-label="anchor" href="#el-m%C3%A9todo-left_join"><i class="fas fa-link"></i></a>
</h4>
<p>El método <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code> mantiene todos los registros de la tabla del lado izquierdo y agrega las columnas de la tabla del lado derecho, en los registros en los que hay coincidencia.</p>
<p>Todos los tipos de <em>joins</em> requiere de al menos una columna que sea común a ambos conjuntos de datos. En este caso, esa columna es <code>cod_canton</code>. Si la columna no tiene el mismo nombre, puede utilizarse el argumento <code>by</code> (ej. <code>by = c(cod_canton_1 = "cod_canton_2")</code>, en donde <code>cod_canton_1</code> es el nombre de la columna en el primer conjunto de datos y <code>cod_canton_2</code> en el segundo).</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Ejemplos de uso de left_join()</span>

<span class="co"># "Join" de los datos geoespaciales de cantones con los de casos positivos de covid. </span>
<span class="co"># Ambas tablas comparten la columna cod_canton.</span>
<span class="va">covid_cantonal_positivos_geoespacial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">cantones</span>, <span class="va">covid_cantonal_positivos</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("cod_canton", "canton", "cod_provin",</span>
<span class="co">#&gt; "provincia")</span>

<span class="co"># Visualización en un mapa generado con plot()</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span>
  <span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">[</span><span class="st">"positivos"</span><span class="op">]</span>,
  extent <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">86.0</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">82.3</span>, ymin <span class="op">=</span> <span class="fl">8.0</span>, ymax <span class="op">=</span> <span class="fl">11.3</span><span class="op">)</span><span class="op">)</span>,
  main <span class="op">=</span> <span class="st">"Casos positivos de covid-19 en cantones de Costa Rica"</span>,
  axes <span class="op">=</span> <span class="cn">TRUE</span>,
  graticule <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="14-operaciones-datos-atributos_files/figure-html/left-join-1.png" width="672"></div>
<p>Seguidamente, se muestra el mismo resultado en un mapa <code>leaflet</code>.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># OPCIONAL: simplificación de geometrías</span>

<span class="va">covid_cantonal_positivos_geoespacial</span> <span class="op">&lt;-</span>
  <span class="va">covid_cantonal_positivos_geoespacial</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fl">5367</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_simplify</a></span><span class="op">(</span>dTolerance <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Función para generar colores</span>
<span class="va">colores</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"YlOrBr"</span>,
               domain <span class="op">=</span> <span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">$</span><span class="va">positivos</span>,
               na.color <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span>

<span class="co"># Mapa</span>
<span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html">setView</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="op">-</span><span class="fl">84.19452</span>,
          lat <span class="op">=</span> <span class="fl">9.572735</span>,
          zoom <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="va">providers</span><span class="op">$</span><span class="va">Stamen.TonerLite</span>, group <span class="op">=</span> <span class="st">"Stamen TonerLite"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># capa base de Stamen TonerLite</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="va">providers</span><span class="op">$</span><span class="va">OpenStreetMap.Mapnik</span>, group <span class="op">=</span> <span class="st">"OpenStreetMap"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># capa base de OSM</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html">addProviderTiles</a></span><span class="op">(</span><span class="va">providers</span><span class="op">$</span><span class="va">Esri.WorldImagery</span>, group <span class="op">=</span> <span class="st">"ESRI World Imagery"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># capa base de ESRI World Imagery</span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addPolygons</a></span><span class="op">(</span>
    <span class="co"># polígonos de cantones</span>
    data <span class="op">=</span> <span class="va">covid_cantonal_positivos_geoespacial</span>,
    fillColor <span class="op">=</span> <span class="op">~</span> <span class="fu">colores</span><span class="op">(</span><span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">$</span><span class="va">positivos</span><span class="op">)</span>,
    fillOpacity <span class="op">=</span> <span class="fl">0.7</span>,
    color <span class="op">=</span> <span class="st">"black"</span>,
    stroke <span class="op">=</span> <span class="cn">TRUE</span>,
    weight <span class="op">=</span> <span class="fl">1.0</span>,
    popup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
        <span class="st">"&lt;strong&gt;Cantón:&lt;/strong&gt;"</span>,
        <span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">$</span><span class="va">canton</span>
      <span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span>
        <span class="st">"&lt;strong&gt;Casos positivos de covid:&lt;/strong&gt;"</span>,
        <span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">$</span><span class="va">positivos</span>
        
      <span class="op">)</span>,
      sep <span class="op">=</span> <span class="st">'&lt;br/&gt;'</span>
    <span class="op">)</span>,
    group <span class="op">=</span> <span class="st">"Casos positivos de covid"</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLayersControl.html">addLayersControl</a></span><span class="op">(</span> <span class="co"># control de capas</span>
    baseGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"Stamen TonerLite"</span>, <span class="st">"OpenStreetMap"</span>, <span class="st">"ESRI World Imagery"</span><span class="op">)</span>,
    overlayGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"Casos positivos de COVID"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html">addLegend</a></span><span class="op">(</span> <span class="co"># leyenda</span>
    position <span class="op">=</span> <span class="st">"bottomleft"</span>,
    pal <span class="op">=</span> <span class="va">colores</span>,
    values <span class="op">=</span> <span class="va">covid_cantonal_positivos_geoespacial</span><span class="op">$</span><span class="va">positivos</span>,
    group <span class="op">=</span> <span class="st">"Casos positivos de COVID"</span>,
    title <span class="op">=</span> <span class="st">"Cantidad de casos"</span>
  <span class="op">)</span></code></pre></div>

</div>
</div>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="introducci%C3%B3n-al-manejo-de-datos-geoespaciales-en-r.html"><span class="header-section-number">13</span> Introducción al manejo de datos geoespaciales en R</a></div>
<div class="next"><a href="examen-corto-1.html">Examen corto 1</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#operaciones-con-datos-de-atributos"><span class="header-section-number">14</span> Operaciones con datos de atributos</a></li>
<li><a class="nav-link" href="#resumen-13"><span class="header-section-number">14.1</span> Resumen</a></li>
<li>
<a class="nav-link" href="#trabajo-previo-9"><span class="header-section-number">14.2</span> Trabajo previo</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#lecturas-7"><span class="header-section-number">14.2.1</span> Lecturas</a></li></ul>
</li>
<li>
<a class="nav-link" href="#preparativos-1"><span class="header-section-number">14.3</span> Preparativos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#carga-de-paquetes-1"><span class="header-section-number">14.3.1</span> Carga de paquetes</a></li>
<li><a class="nav-link" href="#conjuntos-de-datos-para-ejemplos-1"><span class="header-section-number">14.3.2</span> Conjuntos de datos para ejemplos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#introducci%C3%B3n-1"><span class="header-section-number">14.4</span> Introducción</a></li>
<li><a class="nav-link" href="#datos-vectoriales-1"><span class="header-section-number">14.5</span> Datos vectoriales</a></li>
<li>
<a class="nav-link" href="#manejo-de-datos-de-atributos-con-el-paquete-sf"><span class="header-section-number">14.6</span> Manejo de datos de atributos con el paquete sf</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#funciones-b%C3%A1sicas-para-manejo-de-data-frames-y-objetos-sf"><span class="header-section-number">14.6.1</span> Funciones básicas para manejo de data frames y objetos sf</a></li>
<li><a class="nav-link" href="#creaci%C3%B3n-de-subconjuntos"><span class="header-section-number">14.6.2</span> Creación de subconjuntos</a></li>
<li><a class="nav-link" href="#agregaci%C3%B3n-de-datos"><span class="header-section-number">14.6.3</span> Agregación de datos</a></li>
<li><a class="nav-link" href="#cruce-de-datos"><span class="header-section-number">14.6.4</span> Cruce de datos</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/14-operaciones-datos-atributos.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/14-operaciones-datos-atributos.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>GF0604 Procesamiento de datos geográficos 2022-I</strong>" was written by Manuel Vargas. It was last built on 2022-06-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
